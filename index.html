<!DOCTYPE html>
<html lang="en">
<head>
  <title>airplane crahes vis</title>
  <script type="text/javascript" src="http://d3js.org/d3.v2.js"></script>
  <script src="http://d3js.org/d3.v3.min.js"> </script>
  <script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>
  <link rel="stylesheet" type="text/css" href="mystyle.css">


</head>

<body>
<br><br>
<section class"his"></section>
<script type="text/javascript">

var w = 980;
var h = 430;
var margin = 25;
      d3.json("data2.json", function (error,data) {
        if(error){
          console.log("Error loading data")
        }
     

var data = data;

 

 //make Key from 1908 to 2009 -- for now it's till 1949
var dataset = [];
var start = 2010;
var end = 2016
var len = end-start;
for (var i = start; i <= end; i++) {
    dataset.push({
        key: i,
        value:0,
        aboard:0,
        fatalities:0
    });
}

for (var i = 0; i < data.Date.length; i++) {
 
var year = data.Date[i].substr(data.Date[i].length - 4);
var IntYear = parseInt(year);
//var aboard = data.Aboard[i];
//var IntAboard = parseInt(aboard);
var fatalities = data.Fatalities[i];
var IntFatalities = parseInt(fatalities);
dataset[end-IntYear].value +=1;
//dataset[end-IntYear].aboard +=IntAboard;
dataset[end-IntYear].fatalities +=IntFatalities;

}


var key = function(d) {
  return d.key;
};

var value = function(d) {
  return d.value;
};
console.log(dataset);
 
//Create SVG element
var svg = d3.select("body")
      .append("svg")
      .attr("width", w)
      .attr("height", h);
var max = d3.max(dataset, function(d) { return +d.value;} );



///// the histogram

var xScale = d3.scale.ordinal()
        .domain(d3.range(dataset.length+1))
        .rangeRoundBands([80, 980], 0.3); 
var hScale = d3.scale.ordinal()
        .domain(d3.range(end,start-1,-1))
        .rangeRoundBands([80, 880], 0.3);       


var yScale = d3.scale.linear()
                     .domain([0, max+5])
                     .range([400, 40]);
        
var x_axis = d3.svg.axis().scale(hScale).ticks(5);

/////
       
var y_axis = d3.svg.axis().scale(yScale).orient("left");

d3.select("svg")
  .append("g")
    .attr("class","x axis")
    .attr("transform","translate(0,"+(410)+")")//the years
  .call(x_axis)
  .selectAll("text")
    .attr("y", 0)
    .attr("x", 0)
    .attr("dy", ".5em")
    .attr("transform", "rotate(0)")
    .style("text-anchor", "start");
    
//creat tip
var tip = d3.tip()
  .attr('class', 'd3-tip')
  .offset([-10, 0])
  .html(function(d) {
   
    return "<strong>Year :</strong> <span style='color:red'>" + (end-d.key+start+1)  + "</span>"
    +"<br>" +"<strong>Planes Crashed:</strong> <span style='color:red'>" + d.value  + "</span>"
    +"<br>" + "<strong>Total Aboard:</strong> <span style='color:red'>" + d.aboard  + "</span>"
     +"<br>" + "<strong>Total Fatalities:</strong> <span style='color:red'>" + d.fatalities  + "</span>";

    

  })

d3.select("svg")
  .append("g")
    .attr("class","y axis")
    .attr("transform","translate("+margin*1.5+",0)")
  .call(y_axis);

  svg.call(tip);

 function drill(d, i) {
        console.log(d.value); //data object
    }


//Create bars
svg.selectAll("rect")
   .data(dataset, key)
   .enter()
   .append("rect")
   .attr("x", function(d, i) {
    return xScale(i);
   })
   .attr("y", function(d) {
    return yScale(d.value);
   })
   .attr("width", xScale.rangeBand())
   .attr("height", function(d) {
    return (yScale(0) - yScale(d.value));
   })
   .attr("fill", function(d) {
    debugger;
     return "rgb(237, 130, 40)";  
   })
   .on('mouseover', tip.show)
  .on('mouseout', tip.hide)
   .on("click", drill);

svg.selectAll("text")
   .data(dataset, key)
   .enter()
   .append("text")
   .text(function(d) {
    return d.value;
   })
   .attr("text-anchor", "middle")
   .attr("x", function(d, i) {
    return xScale(i) + xScale.rangeBand() / 2;
   })
   .attr("y", function(d) {
    return yScale(d.value) + 4;
   })
   .attr("font-family", "sans-serif") 
   .attr("font-size", "4px")
   .attr("fill", "white");


})   


	var data1 =[30,50,80];
	var r= 200;
	var color = d3.scale.ordinal()
		.range(["red","blue","orange"]);

	var canvas = d3.select("body")
		.append("svg")
		.attr("width",1500)
		.attr("height",1500);

	var group=canvas.append("g")
		.attr("transform","translate(300,300)");

	var arc = d3.svg.arc()
		.innerRadius(100)
		.outerRadius(r);

	var pie = d3.layout.pie()
		.value(function(d){return d;});

	var arcs =  group.selectAll(".arc")
		.data(pie(data1))
		.enter()
		.append("g")
		.attr("class","arc");

	arcs.append("path")
	.attr("d",arc)
	.attr("fill", function(d){return color(d.data);});

	arcs.append("text")
		.attr("transform", function(d){return "translate(" + arc.centroid(d) + ")"})
		.attr("text-anchor", "middle")
		.attr("font-size", "1.5em")
		.text(function(d){return d.data;});
</script>
</body>
</html>